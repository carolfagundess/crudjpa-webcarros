<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Editar Veículo</title>
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id'); // Recupera o ID da URL

                // Carrega os dados do carro para o formulário
                if (id) {
                    fetch(`/api-carros?id=${id}`)
                        .then(response => response.json())
                        .then(carro => {
                            if (carro) {
                                document.getElementById('id').value = carro.id;
                                document.getElementById('modelo').value = carro.modelo;
                                document.getElementById('marca').value = carro.marca;
                                document.getElementById('ano').value = carro.ano;
                                document.getElementById('cor').value = carro.cor;
                            } else {
                                alert("Carro não encontrado.");
                            }
                        })
                        .catch(error => {
                            console.error("Erro ao carregar os dados do carro:", error);
                            alert("Erro ao carregar os dados.");
                        });
                }

                // Lida com o envio do formulário de edição
                const form = document.querySelector("form");
                form.addEventListener("submit", function (event) {
                    event.preventDefault();

                    const carro = {
                        id: document.getElementById("id").value,
                        modelo: document.getElementById("modelo").value,
                        marca: document.getElementById("marca").value,
                        ano: document.getElementById("ano").value,
                        cor: document.getElementById("cor").value
                    };

                    // Faz a requisição PUT para atualizar o carro
                    fetch(`/api-carros/${carro.id}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(carro)
                    })
                        .then(response => {
                            if (response.ok) {
                                alert("Carro atualizado com sucesso!");
                                window.location.href = "lista.html"; // Redireciona para a lista após sucesso
                            } else {
                                alert("Erro ao atualizar o carro.");
                            }
                        })
                        .catch(error => {
                            console.error("Erro ao atualizar carro:", error);
                            alert("Erro ao atualizar o carro.");
                        });
                });
            });
        </script>
    </head>
    <body>
        <div class="container mt-5">
            <h2>Editar Veículo</h2>
            <form>
                <div class="form-group">
                    <label for="id">ID</label>
                    <input type="text" class="form-control" id="id" disabled>
                </div>
                <div class="form-group">
                    <label for="modelo">Modelo</label>
                    <input type="text" class="form-control" id="modelo" placeholder="Digite o modelo">
                </div>
                <div class="form-group">
                    <label for="marca">Marca</label>
                    <input type="text" class="form-control" id="marca" placeholder="Digite a marca">
                </div>
                <div class="form-group">
                    <label for="ano">Ano</label>
                    <input type="number" class="form-control" id="ano" placeholder="Digite o ano">
                </div>
                <div class="form-group">
                    <label for="cor">Cor</label>
                    <input type="text" class="form-control" id="cor" placeholder="Digite a cor">
                </div>
                <button type="submit" class="btn btn-primary">Atualizar</button>
            </form>
            <a href="lista.html" class="btn btn-secondary mt-3">Voltar para a lista</a>
        </div>
    </body>
</html>
